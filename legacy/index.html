<html>
    <head>
        <!-- Global site tag (gtag.js) - Google Analytics -->
        <script async src="https://www.googletagmanager.com/gtag/js?id=UA-117255756-1"></script>
        <script>
        window.dataLayer = window.dataLayer || [];
        function gtag(){dataLayer.push(arguments);}
        gtag('js', new Date());

        gtag('config', 'UA-117255756-1');
        </script>

        <meta name="viewport" content="width=device-width, initial-scale=0.8, maximum-scale=0.8" />
        <link rel="icon" type="image/png" href="./img/steem.png" />
        <link href="https://fonts.googleapis.com/css?family=Teko|Abel|Quicksand|Roboto|Nunito" rel="stylesheet">        
        <link rel="stylesheet" href="https://maxcdn.bootstrapcdn.com/bootstrap/4.0.0/css/bootstrap.min.css" integrity="sha384-Gn5384xqQ1aoWXA+058RXPxPg6fy4IWvTNh0E263XmFcJlSAwiGgFAW/dAiS6JXm" crossorigin="anonymous">
        <script src="https://code.jquery.com/jquery-3.2.1.slim.min.js" integrity="sha384-KJ3o2DKtIkvYIK3UENzmM7KCkRr/rE9/Qpg6aAZGJwFDMVNA/GpGFF93hXpG5KkN" crossorigin="anonymous"></script>
        <script src="https://cdnjs.cloudflare.com/ajax/libs/popper.js/1.12.9/umd/popper.min.js" integrity="sha384-ApNbgh9B+Y1QKtv3Rn7W3mgPxhU9K/ScQsAP7hUibX39j7fakFPskvXusvfa0b4Q" crossorigin="anonymous"></script>
        <script src="https://maxcdn.bootstrapcdn.com/bootstrap/4.0.0/js/bootstrap.min.js" integrity="sha384-JZR6Spejh4U02d8jOt6vLEHfe/JQGiRRSQQxSfFWpi1MquVdAyjUar5+76PVCmYl" crossorigin="anonymous"></script>

        <link href="./css/viewer.css" rel="stylesheet">
        <script src="./js/steem.min.js"></script>
        <script src="./js/react.js"></script>
        <script src="./js/react-dom.js"></script>
        <script src="./js/browser.min.js"></script>
        <script src="./js/Chart.min.js"></script>
        <script src="./js/pallete.js"></script>
        <script src="./js/tools.js"></script>
        <script src="https://rawgit.com/sitepoint-editors/jsqrcode/master/src/qr_packed.js"></script>
        
        <script type="text/javascript">
  let loginStatus = false;
  let loggedInAccount = "";

  $(document).ready(function () {
    $("#loginAccount").keydown(function (key) {
      if (key.keyCode == 13) {
        doLogin($("#loginAccount").val());
      }
    });
  });

  $("#logout").on("click", logoutUser);
  $("#login").on(
    "click",
    {
      kind: "click",
    },
    doLogin
  );

  const storageKey = "upvuKeychainAuth";

  function doLogin(inUsername) {
    if (steem_keychain) {
      const username =
        inUsername && inUsername.data ? $("#loginAccount").val() : inUsername;

      const posting = $.post(
        "/users/login",
        {
          account: username,
        },
        function (result) {
          if (result.result == "success") {
            // Call request sign buffer method with username, random memo and Posting key
            steem_keychain.requestSignBuffer(
              username,
              `upvu-${Math.floor(100000000 + Math.random() * 900000000)}`,
              "Posting",
              (response) => {
                if (response.success === true) {
                  const user = {
                    username: response.data.username,
                    type: "keychain",
                  };

                  setUser(user);
                } else {
                  //  Verification failed
                  logoutUser();
                }
              }
            );
          }
        },
        "json"
      );
    }
  }

  function userLoggedIn() {
    const value = localStorage.getItem(storageKey);

    return value ? JSON.parse(value) : false;
  }

  function setUser(token) {
    loginStatus = true;
    loggedInAccount = token.username;
    localStorage.setItem(storageKey, JSON.stringify(token));
    location.href = "/myPage";
  }

  function logoutUser() {
    loginStatus = false;
    loggedInAccount = "";
    localStorage.removeItem(storageKey);

    const posting = $.post(
      "/users/logout",
      {},
      function (result) {
        if (result.result == "success") {
          location.href = "/";
        }
      },
      "json"
    );
  }

  async function call_get(url, params) {
    return await axios({
      url,
      method: "GET",
      params,
    })
      .then((response) => {
        return response.data;
      })
      .catch((err) => {
        console.error(`Could not fetch data, url: ${url}`);
        return {};
      });
  }

  async function call_post(url, params) {
    return await axios({
      url,
      method: "POST",
      params,
    })
      .then((response) => {
        return response.data;
      })
      .catch((err) => {
        console.error(`Could not fetch data, url: ${url}`);
        return {};
      });
  }
</script>

        
        
        
        
        
    </head>
    <body> 
        <div class="page_header">
            <span onClick="document.location.href='./'" style="cursor: pointer;">Steem Pay</span>
              <div class="right menu">
    <div class="item">
      <img
        id="account_img"
        class="ui avatar image"
        src="https://steemitimages.com/u/default/avatar"
      />
      <span
        id="account_name"
        style="width:100px;display: none; ;"
        > </span
      >

      <div class="ui input">
        <input
          type="text"
          placeholder="account"
          id="loginAccount"
          style="width:170px;display: inline; ;"
          value=""
        />
      </div>
    </div>
    <div class="item">
      <button
        id="login"
        class="ui primary button"
        style="display: inline; "
      >
        Login
      </button>
      <button
        id="logout"
        class="ui red button"
        style="display: none; "
      >
        Logout
      </button>
    </div>
  </div>
            
            
            
        </div>
        <div id="content_area"></div>
        <!-- Modal -->
        <div class="modal fade" id="pay-modal" tabindex="-1" role="dialog" aria-labelledby="myModalLabel" aria-hidden="true"  data-backdrop="static" data-keyboard="false">
            <div class="modal-dialog">
                <div class="modal-content">
                    <div class="modal-body">
                        <div id="pay-detail"></div>
                    </div>
                </div>
            </div>
        </div>
        <footer class="footer">
            <div class="footer-text">
              <span class="text-muted">Steem Pay | v0.2 | created by <a href="https://steemit.com/@ayogom">@ayogom</a></span>
            </div>
        </footer>         
    </body>
</html>
<script type="text/babel" src="./jsx/pay.jsx"></script>
